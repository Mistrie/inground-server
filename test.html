<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="ko" xmlns:v="urn:schemas-microsoft-com:vml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>Inground API Test</title>
	<script type="text/javascript" src="http://code.jquery.com/jquery-1.7.2.min.js"></script>
</head>
<body>
<script type="text/javascript" src="http://openapi.map.naver.com/openapi/naverMap.naver?ver=2.0&key=519c697d875130767d965dae24480145"></script>
<div id="map" style="border:1px solid #ccc;"></div>
<script type="text/javascript">
var oMap = null;
var oMarker = null;
var map = [];
var url = '/';
var doLogin = function() {
	$.ajax({
		type: 'POST',
		url: url,
		dataType: 'json',
		data: JSON.stringify({
			kind: "login",
			account: $('#account').attr('value')
		})
	}).done(function(xhr) {
		alert('login done');
	}).fail(function(xhr) {
		var json = $.parseJSON(xhr.responseText);
		alert('login fail : ' + json.message);
	});
};
var doMap = function() {
	$.ajax({
		type: 'POST',
		url: url,
		dataType: 'json',
		data: JSON.stringify({
			kind: "map"
		})
	}).done(function(data) {
		var lat_min = 90, lat_max = -90, lng_min = 180, lng_max = -180;
		for(var i = 0; i < data.map.length; i++) {
			var lat = data.map[i][0], lng = data.map[i][1];
			if(lat < lat_min) lat_min = lat;
			else if(lat > lat_max) lat_max = lat;
			if(lng < lng_min) lng_min = lng;
			else if(lng > lng_max) lng_max = lng;
		}
		var boundary = [new nhn.api.map.LatLng(lat_min, lng_min),
						new nhn.api.map.LatLng(lat_max, lng_max)];
		oMap = new nhn.api.map.Map(document.getElementById('map'), {
			boundary: boundary,
			boundaryOffset: 0,
			enableDblClickZoom : false,
			mapMode : 0,
			activateTrafficMap : false,
			activateBicycleMap : false,
			minMaxLevel : [ 11, 14 ],
			size : new nhn.api.map.Size(800, 480)
		});

		// - Draggable Marker 의 경우 Icon 인자는 Sprite Icon이 된다.
		// - 따라서 Sprite Icon 을 사용하기 위해 기본적으로 사용되는 값을 지정한다.
		// - Sprite Icon 을 사용하기 위해서 상세한 내용은 레퍼런스 페이지의 nhn.api.map.SpriteIcon 객체를 참조하면 된다.
		var testdefaultSpriteIcon = {
			url : "http://static.naver.com/maps2/icons/pin_spot2.png",
			size : {width:28, height:37},
			spriteSize : {width:28, height:37},
			imgOrder : 0,
			offset : {width:14, height:37}
		};
		// - 위에서 지정한 기본값을 이용해 실제로 SpriteIcon 을 생성한다.
		var testDupSpriteIcon_first = new nhn.api.map.SpriteIcon(testdefaultSpriteIcon.url, testdefaultSpriteIcon.size, testdefaultSpriteIcon.spriteSize, 0, testdefaultSpriteIcon.offset);
		oMarker = new nhn.api.map.DraggableMarker(testDupSpriteIcon_first, {
			title : 'me',
			point : oMap.getCenter(),
			zIndex : 1,
			smallSrc : testDupSpriteIcon_first
		});
		oMap.addOverlay(oMarker);

		map = [];
		for(var i = 0; i < data.map.length; i++) {
			var circle = new nhn.api.map.Circle({
				strokeColor : "#cccccc",
				strokeOpacity : 1,
				strokeWidth : 1,
				fillColor : "none",
				radius : 1
			});
			circle.setCenterPoint(new nhn.api.map.LatLng(data.map[i][0], data.map[i][1]));
			oMap.addOverlay(circle);
			map.push(circle);
		}
	}).fail(function(xhr) {
		var json = $.parseJSON(xhr.responseText);
		alert('login fail : ' + json.message);
	});
};
var doStart = function() {
	$.ajax({
		type: 'POST',
		url: url,
		dataType: 'json',
		data: JSON.stringify({
			kind: "start",
			location: [oMarker.getPoint().getY(), oMarker.getPoint().getX()]
		})
	}).done(function(data) {
		alert(data.success);
		if(data.success) {
			// TODO: polling 시작
		}
	}).fail(function(xhr) {
		var json = $.parseJSON(xhr.responseText);
		alert('start fail : ' + json.message);
	});
};
$(document).ready(function() {
	$('#bLogin').click(doLogin);
	$('#bMap').click(doMap);
	$('#bStart').click(doStart);
});
</script>
<input id="account" type="text" />
<button id="bLogin" type="button">login</button>
<button id="bMap" type="button">map</button>
<button id="bStart" type="button">start</button>
</body>
</html>
